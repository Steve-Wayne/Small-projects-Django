<!DOCTYPE html>
<html lang="en">
<head>
    <title>Weather Forecast App</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/templatemo-style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        /* General Body Styling */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        /* Header Styling */
        header.main-header {
            background-color: #2a3d66;
            color: white;
            padding: 30px 0;
            text-align: center;
            font-size: 2.5em;
        }

        /* Weather Section */
        .weather-content {
            padding: 40px 0;
        }

        .container {
            width: 80%;
            margin: 0 auto;
        }

        .search-form {
            margin: 20px 0;
        }

        .form-control {
            width: 60%;
            display: inline-block;
            padding: 10px;
            margin-right: 10px;
        }

        .btn-primary {
            background-color: #2a3d66;
            border-color: #2a3d66;
            padding: 10px 20px;
        }

        .btn-primary:hover {
            background-color: #1f2b44;
            border-color: #1f2b44;
        }

        .weather-info, .forecast {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .weather-info h2 {
            font-size: 2em;
            color: #333;
        }

        .forecast h3 {
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        .forecast-day {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .forecast-day p {
            margin: 5px 0;
        }

        /* Map Section */
        .map-section {
            margin-top: 40px;
        }

        #map {
            height: 500px;
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* Footer Styling */
        footer.main-footer {
            background-color: #2a3d66;
            color: white;
            padding: 20px 0;
            text-align: center;
            font-size: 1em;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                width: 95%;
            }

            .form-control {
                width: 80%;
            }

            .btn-primary {
                width: 100%;
                margin-top: 10px;
            }

            .forecast-day {
                padding: 10px;
            }
        }
    </style>
</head>
<body>

    <!-- HEADER -->
    <header class="main-header">
        Weather Forecast App
    </header>

    <!-- MAIN CONTENT -->
    <section class="weather-content">
        <div class="container text-center">
            <!-- Search Bar -->
            <form method="get" action="{% url 'weather_search' %}" class="search-form">
                <input type="text" name="city" placeholder="Enter city name" class="form-control" required>
                <button type="submit" class="btn btn-primary">Search</button>
            </form>

            <!-- Weather Information -->
            {% if weather %}
            <div class="weather-info mt-5">
                <h2>Current Weather in {{ weather.city }}</h2>
                <p>Temperature: {{ weather.temperature }}°C</p>
                <p>Humidity: {{ weather.humidity }}%</p>
                <p>Wind Speed: {{ weather.wind_speed }} km/h</p>
            </div>
            {% endif %}

            <!-- Forecast -->
            {% if forecast %}
            <div class="forecast mt-5">
                <h3>5-Day Forecast</h3>
                <div class="row">
                    {% for day in forecast %}
                    <div class="col-sm-4 forecast-day">
                        <p><strong>{{ day.date }}</strong></p>
                        <p>{{ day.temperature }}°C</p>
                        <p>{{ day.condition }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- MAP SECTION -->
    <section class="map-section">
        <h2 class="text-center">Interactive Map</h2>
        <div id="map"></div>
    </section>

    <!-- FOOTER -->
    <footer class="main-footer">
        <p>&copy; 2024 Weather Forecast App. All Rights Reserved.</p>
    </footer>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

    <script>
        // Initialize the map
        const map = L.map('map').setView([20, 0], 2); // Centered on the world map

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Add a click event listener
        map.on('click', async (e) => {
            const { lat, lng } = e.latlng;

            // Use reverse geocoding to find the country name (e.g., Nominatim API)
            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
            const data = await response.json();
            const country = data.address.country;

            if (country) {
                // Fetch weather data for the country
                const weatherResponse = await fetch(`/get_weather_data?country=${encodeURIComponent(country)}`);
                const weatherData = await weatherResponse.json();

                // Display weather data
                alert(`Weather in ${country}: \nTemperature: ${weatherData.temperature}°C \nHumidity: ${weatherData.humidity}%`);
            } else {
                alert("Could not find the country. Try again.");
            }
        });
    </script>
</body>
</html>
